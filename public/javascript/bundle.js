function painter(a){a.height=Math.min(500,window.innerHeight-(200+window.innerHeight%20)),a.width=Math.min(700,.95*window.innerWidth),this.canvas=a,this.ctx=a.getContext("2d"),this.graphUtil=new graphUtility,this.clearing=!0,this.isLogPolar=!1}function graphUtility(){}function downloadCanvas(a,t,n){a.href=document.getElementById("canvas").toDataURL(),a.download=n}graphUtility.prototype.convertToCartesian=function(a,t){cartesian=new Array(t.width);for(var n=0;n<t.width;n+=1)cartesian[n]=new Array(t.height);for(var i=0,e=0;e<t.height;e+=1)for(var r=0;r<t.width;r+=1)cartesian[r][e]=new Array(4),cartesian[r][e][0]=a[i],cartesian[r][e][1]=a[i+1],cartesian[r][e][2]=a[i+2],cartesian[r][e][3]=a[i+3],i+=4;return cartesian},graphUtility.prototype.convertToImageData=function(a,t){for(var n=new Array,i=0;i<t.height;i+=1)for(var e=0;e<t.width;e+=1)for(var r=0;r<a[e][i].length;r+=1)n.push(a[e][i][r]);return n},painter.prototype.animate=function(){this.animating=!this.animating,this.clearing||(this.clearing=!0,this.drawImage())},painter.prototype.drawImage=function(){if(this.clearing){this.clearing=!1;var a=new Image;a.crossOrigin="anonymous",a.src="japanese-pattern.png",a.onload=function(){if(this.canvas.width=a.naturalWidth,this.canvas.height=a.naturalHeight,this.ctx.drawImage(a,0,0),a.style.display="none",this.isLogPolar){var t=this.ctx.getImageData(0,0,canvas.width,canvas.height),n=t.data;newData=this.logPolar(n);for(var i=0;i<n.length;i+=4)n[i]=newData[i],n[i+1]=newData[i+1],n[i+2]=newData[i+2],n[i+3]=newData[i+3];this.ctx.putImageData(t,0,0)}}.bind(this)}},painter.prototype.clear=function(){var a=this.ctx.getImageData(0,0,canvas.width,canvas.height);d=a.data;for(var t=0;t<d.length;t+=4)d[t+3]=0;this.ctx.putImageData(a,0,0)},painter.prototype.setClear=function(){this.clearing=!0,this.clear()},painter.prototype.setLogPolar=function(){this.isLogPolar=!this.isLogPolar,this.clearing||(this.clearing=!0,this.drawImage())},painter.prototype.logPolar=function(a){for(var t=a,n=this.graphUtil.convertToCartesian(t,this.canvas),i=new Array(canvas.width),e=0;e<canvas.width;e+=1){i[e]=new Array(canvas.height);for(var r=0;r<canvas.height;r+=1)i[e][r]=new Array(4)}for(var o=Math.floor(canvas.width/2),h=Math.floor(canvas.height/2),e=0;e<canvas.height;e+=1)for(var r=0;r<canvas.width;r+=1){var s=Math.sqrt(Math.pow(r-o,2)+Math.pow(e-h,2)),c=Math.atan((e-h)/(r-o));if(!isNaN(c)){o>r&&(c+=Math.PI),0>c&&(c+=2*Math.PI);for(var g=Math.round(c*((canvas.height-1)/(2*Math.PI))),d=(canvas.width-1)/Math.log(Math.sqrt(Math.pow(canvas.height,2)+Math.pow(canvas.width,2))/2),l=Math.round(d*Math.log(s)),v=0;v<i[r][e].length;v++)i[r][e][v]=n[l][g][v]}}return this.graphUtil.convertToImageData(i,this.canvas)},canvas=document.getElementById("canvas"),myPainter=new painter(canvas);var drawbtn=document.getElementById("drawbtn");drawbtn.addEventListener("click",myPainter.drawImage.bind(myPainter));var clearbtn=document.getElementById("clearbtn");clearbtn.addEventListener("click",myPainter.setClear.bind(myPainter));var logpolarbtn=document.getElementById("logpolarbtn");logpolarbtn.addEventListener("click",myPainter.setLogPolar.bind(myPainter)),document.getElementById("download").addEventListener("click",function(){downloadCanvas(this,"canvas","canvas-download.png")},!1);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJwYWludGVyIiwiY2FudmFzIiwiaGVpZ2h0IiwiTWF0aCIsIm1pbiIsIndpbmRvdyIsImlubmVySGVpZ2h0Iiwid2lkdGgiLCJpbm5lcldpZHRoIiwidGhpcyIsImN0eCIsImdldENvbnRleHQiLCJncmFwaFV0aWwiLCJncmFwaFV0aWxpdHkiLCJjbGVhcmluZyIsImlzTG9nUG9sYXIiLCJkb3dubG9hZENhbnZhcyIsImxpbmsiLCJjYW52YXNJZCIsImZpbGVuYW1lIiwiaHJlZiIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ0b0RhdGFVUkwiLCJkb3dubG9hZCIsInByb3RvdHlwZSIsImNvbnZlcnRUb0NhcnRlc2lhbiIsImRhdGEiLCJjYXJ0ZXNpYW4iLCJBcnJheSIsImkiLCJkIiwieSIsIngiLCJjb252ZXJ0VG9JbWFnZURhdGEiLCJsZW5ndGgiLCJwdXNoIiwiYW5pbWF0ZSIsImFuaW1hdGluZyIsImRyYXdJbWFnZSIsImltZyIsIkltYWdlIiwiY3Jvc3NPcmlnaW4iLCJzcmMiLCJvbmxvYWQiLCJuYXR1cmFsV2lkdGgiLCJuYXR1cmFsSGVpZ2h0Iiwic3R5bGUiLCJkaXNwbGF5IiwiaW1hZ2VEYXRhIiwiZ2V0SW1hZ2VEYXRhIiwibmV3RGF0YSIsImxvZ1BvbGFyIiwicHV0SW1hZ2VEYXRhIiwiYmluZCIsImNsZWFyIiwic2V0Q2xlYXIiLCJzZXRMb2dQb2xhciIsImNhcnRlc2lhbkZpZWxkIiwibmV3RmllbGQiLCJqIiwibWlkWCIsImZsb29yIiwibWlkWSIsInIiLCJzcXJ0IiwicG93IiwidGhldGEiLCJhdGFuIiwiaXNOYU4iLCJQSSIsInJvdW5kIiwieFNjYWxlIiwibG9nIiwidyIsIm15UGFpbnRlciIsImRyYXdidG4iLCJhZGRFdmVudExpc3RlbmVyIiwiY2xlYXJidG4iLCJsb2dwb2xhcmJ0biJdLCJtYXBwaW5ncyI6IkFBQUEsUUFBQUEsU0FBQUMsR0FDQUEsRUFBQUMsT0FBQUMsS0FBQUMs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ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBmdW5jdGlvbiBwYWludGVyKGNhbnZhcykge1xuICAgICAgY2FudmFzLmhlaWdodCA9IE1hdGgubWluKDUwMCwgd2luZG93LmlubmVySGVpZ2h0LSgyMDAgKyB3aW5kb3cuaW5uZXJIZWlnaHQgJSAyMCkpO1xuICAgICAgY2FudmFzLndpZHRoID0gTWF0aC5taW4oNzAwLCB3aW5kb3cuaW5uZXJXaWR0aCowLjk1KTtcbiAgICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xuICAgICAgdGhpcy5jdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgIHRoaXMuZ3JhcGhVdGlsID0gbmV3IGdyYXBoVXRpbGl0eSgpO1xuICAgICAgdGhpcy5jbGVhcmluZyA9IHRydWU7XG4gICAgICB0aGlzLmlzTG9nUG9sYXIgPSBmYWxzZTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gZ3JhcGhVdGlsaXR5KCl7fTtcblxuICAgIGdyYXBoVXRpbGl0eS5wcm90b3R5cGUuY29udmVydFRvQ2FydGVzaWFuID0gZnVuY3Rpb24oZGF0YSwgY2FudmFzKXtcbiAgICAgIGNhcnRlc2lhbiA9IG5ldyBBcnJheShjYW52YXMud2lkdGgpO1xuICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGNhbnZhcy53aWR0aDsgaSArPSAxKXtcbiAgICAgICAgY2FydGVzaWFuW2ldID0gbmV3IEFycmF5KGNhbnZhcy5oZWlnaHQpO1xuICAgICAgfVxuICAgICAgdmFyIGQgPSAwO1xuICAgICAgZm9yKHZhciB5ID0gMDsgeSA8IGNhbnZhcy5oZWlnaHQ7IHkgKz0gMSl7XG4gICAgICAgIGZvcih2YXIgeCA9IDA7IHggPCBjYW52YXMud2lkdGg7IHggKz0gMSl7XG4gICAgICAgICAgY2FydGVzaWFuW3hdW3ldID0gbmV3IEFycmF5KDQpO1xuICAgICAgICAgIGNhcnRlc2lhblt4XVt5XVswXSA9IGRhdGFbZF07XG4gICAgICAgICAgY2FydGVzaWFuW3hdW3ldWzFdID0gZGF0YVtkICsgMV07XG4gICAgICAgICAgY2FydGVzaWFuW3hdW3ldWzJdID0gZGF0YVtkICsgMl07XG4gICAgICAgICAgY2FydGVzaWFuW3hdW3ldWzNdID0gZGF0YVtkICsgM107XG4gICAgICAgICAgZCArPSA0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gY2FydGVzaWFuO1xuICAgIH07XG5cbiAgICBncmFwaFV0aWxpdHkucHJvdG90eXBlLmNvbnZlcnRUb0ltYWdlRGF0YSA9IGZ1bmN0aW9uIChjYXJ0ZXNpYW4sIGNhbnZhcyl7XG4gICAgICB2YXIgZGF0YSA9IG5ldyBBcnJheSgpO1xuICAgICAgZm9yKHZhciB5ID0gMDsgeSA8IGNhbnZhcy5oZWlnaHQ7IHkgKz0gMSl7XG4gICAgICAgIGZvcih2YXIgeCA9IDA7IHggPCBjYW52YXMud2lkdGg7IHggKz0gMSl7XG4gICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGNhcnRlc2lhblt4XVt5XS5sZW5ndGg7IGkgKz0gMSl7XG4gICAgICAgICAgICBkYXRhLnB1c2goY2FydGVzaWFuW3hdW3ldW2ldKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH07XG5cbiAgICBwYWludGVyLnByb3RvdHlwZS5hbmltYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmFuaW1hdGluZyA9ICF0aGlzLmFuaW1hdGluZztcbiAgICAgIGlmKHRoaXMuY2xlYXJpbmcpIHJldHVybjtcbiAgICAgIHRoaXMuY2xlYXJpbmcgPSB0cnVlO1xuICAgICAgdGhpcy5kcmF3SW1hZ2UoKTtcbiAgICB9O1xuXG4gICAgcGFpbnRlci5wcm90b3R5cGUuZHJhd0ltYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZighdGhpcy5jbGVhcmluZykgcmV0dXJuO1xuICAgICAgdGhpcy5jbGVhcmluZyA9IGZhbHNlO1xuICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgaW1nLmNyb3NzT3JpZ2luID0gJ2Fub255bW91cyc7XG4gICAgICBpbWcuc3JjID0gJ2phcGFuZXNlLXBhdHRlcm4ucG5nJztcbiAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSBpbWcubmF0dXJhbFdpZHRoO1xuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSBpbWcubmF0dXJhbEhlaWdodDtcbiAgICAgICAgdGhpcy5jdHguZHJhd0ltYWdlKGltZywgMCwgMCk7XG4gICAgICAgIGltZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBpZih0aGlzLmlzTG9nUG9sYXIpe1xuICAgICAgICAgIHZhciBpbWFnZURhdGEgPSB0aGlzLmN0eC5nZXRJbWFnZURhdGEoMCwwLGNhbnZhcy53aWR0aCxjYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgICB2YXIgZCA9IGltYWdlRGF0YS5kYXRhO1xuICAgICAgICAgIG5ld0RhdGEgPSB0aGlzLmxvZ1BvbGFyKGQpO1xuICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBkLmxlbmd0aDsgaSArPSA0KXtcbiAgICAgICAgICAgIGRbaV0gPSBuZXdEYXRhW2ldO1xuICAgICAgICAgICAgZFtpKzFdID0gbmV3RGF0YVtpKzFdO1xuICAgICAgICAgICAgZFtpKzJdID0gbmV3RGF0YVtpKzJdO1xuICAgICAgICAgICAgZFtpKzNdID0gbmV3RGF0YVtpKzNdO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmN0eC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLDAsMCk7XG4gICAgICAgIH1cbiAgICAgIH0uYmluZCh0aGlzKTtcbiAgICB9O1xuXG4gICAgcGFpbnRlci5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBpbWFnZURhdGEgPSB0aGlzLmN0eC5nZXRJbWFnZURhdGEoMCwwLGNhbnZhcy53aWR0aCxjYW52YXMuaGVpZ2h0KTtcbiAgICAgIGQgPSBpbWFnZURhdGEuZGF0YTtcbiAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBkLmxlbmd0aDsgaSArPSA0KXtcbiAgICAgICAgZFtpKzNdID0gMDtcbiAgICAgIH1cbiAgICAgIHRoaXMuY3R4LnB1dEltYWdlRGF0YShpbWFnZURhdGEsMCwwKTtcbiAgICB9O1xuXG4gICAgcGFpbnRlci5wcm90b3R5cGUuc2V0Q2xlYXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuY2xlYXJpbmcgPSB0cnVlO1xuICAgICAgdGhpcy5jbGVhcigpO1xuICAgIH07XG5cbiAgICBwYWludGVyLnByb3RvdHlwZS5zZXRMb2dQb2xhciA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5pc0xvZ1BvbGFyID0gIXRoaXMuaXNMb2dQb2xhcjtcbiAgICAgIGlmKHRoaXMuY2xlYXJpbmcpIHJldHVybjtcbiAgICAgIHRoaXMuY2xlYXJpbmcgPSB0cnVlO1xuICAgICAgdGhpcy5kcmF3SW1hZ2UoKTtcbiAgICB9XG5cbiAgICBwYWludGVyLnByb3RvdHlwZS5sb2dQb2xhciA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgIHZhciBkID0gZGF0YTtcbiAgICAgIHZhciBjYXJ0ZXNpYW5GaWVsZCA9IHRoaXMuZ3JhcGhVdGlsLmNvbnZlcnRUb0NhcnRlc2lhbihkLCB0aGlzLmNhbnZhcyk7XG4gICAgICB2YXIgbmV3RmllbGQgPSBuZXcgQXJyYXkoY2FudmFzLndpZHRoKTtcbiAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBjYW52YXMud2lkdGg7IGkgKz0gMSl7XG4gICAgICAgIG5ld0ZpZWxkW2ldID0gbmV3IEFycmF5KGNhbnZhcy5oZWlnaHQpO1xuICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgY2FudmFzLmhlaWdodDsgaiArPSAxKXtcbiAgICAgICAgICBuZXdGaWVsZFtpXVtqXSA9IG5ldyBBcnJheSg0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdmFyIG1pZFggPSBNYXRoLmZsb29yKGNhbnZhcy53aWR0aC8yKTtcbiAgICAgIHZhciBtaWRZID0gTWF0aC5mbG9vcihjYW52YXMuaGVpZ2h0LzIpO1xuICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGNhbnZhcy5oZWlnaHQ7IGkgKz0gMSl7XG4gICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCBjYW52YXMud2lkdGg7IGogKz0gMSl7XG4gICAgICAgICAgdmFyIHIgPSBNYXRoLnNxcnQoTWF0aC5wb3coaiAtIG1pZFgsIDIpICsgTWF0aC5wb3coaSAtIG1pZFksIDIpKTtcbiAgICAgICAgICB2YXIgdGhldGEgPSBNYXRoLmF0YW4oKGkgLSBtaWRZKS8oaiAtIG1pZFgpKTtcbiAgICAgICAgICBpZihpc05hTih0aGV0YSkpIGNvbnRpbnVlO1xuICAgICAgICAgIGlmKGogPCBtaWRYKSB0aGV0YSArPSBNYXRoLlBJO1xuICAgICAgICAgIGlmKHRoZXRhIDwgMCkgdGhldGEgKz0gMipNYXRoLlBJO1xuICAgICAgICAgIHZhciB5ID0gTWF0aC5yb3VuZCh0aGV0YSAqICggKGNhbnZhcy5oZWlnaHQtMSkgLyAoMipNYXRoLlBJKSApKTtcbiAgICAgICAgICB2YXIgeFNjYWxlID0gKGNhbnZhcy53aWR0aCAtIDEpIC8gTWF0aC5sb2coTWF0aC5zcXJ0KE1hdGgucG93KGNhbnZhcy5oZWlnaHQsMikgKyBNYXRoLnBvdyhjYW52YXMud2lkdGgsMikpLzIpXG4gICAgICAgICAgdmFyIHggPSBNYXRoLnJvdW5kKHhTY2FsZSAqIE1hdGgubG9nKHIpKTtcbiAgICAgICAgICBmb3IodmFyIHcgPSAwOyB3IDwgbmV3RmllbGRbal1baV0ubGVuZ3RoOyB3Kyspe1xuICAgICAgICAgICAgbmV3RmllbGRbal1baV1bd10gPSBjYXJ0ZXNpYW5GaWVsZFt4XVt5XVt3XTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmdyYXBoVXRpbC5jb252ZXJ0VG9JbWFnZURhdGEobmV3RmllbGQsIHRoaXMuY2FudmFzKTtcbiAgICB9O1xuXG4gICAgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpO1xuICAgIG15UGFpbnRlciA9IG5ldyBwYWludGVyKGNhbnZhcyk7XG4gICAgdmFyIGRyYXdidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJhd2J0bicpO1xuICAgIGRyYXdidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBteVBhaW50ZXIuZHJhd0ltYWdlLmJpbmQobXlQYWludGVyKSk7XG4gICAgdmFyIGNsZWFyYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyYnRuJyk7XG4gICAgY2xlYXJidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBteVBhaW50ZXIuc2V0Q2xlYXIuYmluZChteVBhaW50ZXIpKTtcbiAgICB2YXIgbG9ncG9sYXJidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9ncG9sYXJidG4nKTtcbiAgICBsb2dwb2xhcmJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG15UGFpbnRlci5zZXRMb2dQb2xhci5iaW5kKG15UGFpbnRlcikpO1xuXG5cbiAgICBmdW5jdGlvbiBkb3dubG9hZENhbnZhcyhsaW5rLCBjYW52YXNJZCwgZmlsZW5hbWUpIHtcbiAgICAgIGxpbmsuaHJlZiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKS50b0RhdGFVUkwoKTtcbiAgICAgIGxpbmsuZG93bmxvYWQgPSBmaWxlbmFtZTtcbiAgICB9XG5cbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG93bmxvYWQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgZG93bmxvYWRDYW52YXModGhpcywgJ2NhbnZhcycsICdjYW52YXMtZG93bmxvYWQucG5nJyk7XG4gICAgfSwgZmFsc2UpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
